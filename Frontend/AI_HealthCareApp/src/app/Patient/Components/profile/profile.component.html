<div class="container" style="margin-top: 25px">
  <section *ngIf="Patient" role="region" aria-label="Patient Profile" class="profile-card" tabindex="0">
    <header class="profile-header" id="profile-title">
      <h3>Your Profile</h3>
    </header>
    <div class="profile-item">
      <i class="bi bi-person"></i>
      <span class="profile-label">Name:</span>
      <span class="profile-value">{{ Patient.name }}</span>
      <button class="edit-btn" aria-label="Edit Name" (click)="EditDetails()">
        <i class="bi bi-pencil"></i>
      </button>
    </div>
    <div class="profile-item">
      <i class="bi bi-telephone"></i>
      <span class="profile-label">Mobile No:</span>
      <span class="profile-value">{{ Patient.mobileno }}</span>
      <button class="edit-btn" aria-label="Edit Mobile No" (click)="EditDetails()">
        <i class="bi bi-pencil"></i>
      </button>
    </div>
    <div class="profile-item">
      <i class="bi bi-gender-ambiguous"></i>
      <span class="profile-label">Gender:</span>
      <span class="profile-value">{{ Patient.gender }}</span>
      <button class="edit-btn" aria-label="Edit Gender" (click)="EditDetails()">
        <i class="bi bi-pencil"></i>
      </button>
    </div>
    <div class="profile-item">
      <i class="bi bi-calendar"></i>
      <span class="profile-label">Age:</span>
      <span class="profile-value">{{ Patient.age }}</span>
      <button class="edit-btn" aria-label="Edit Age" (click)="EditDetails()">
        <i class="bi bi-pencil"></i>
      </button>
    </div>
    <div class="profile-item" style="grid-column: 1 / -1">
      <i class="bi bi-house"></i>
      <span class="profile-label">Address:</span>
      <span class="profile-value">{{ Patient.address }}</span>
      <button class="edit-btn" aria-label="Edit Address" (click)="EditDetails()">
        <i class="bi bi-pencil"></i>
      </button>
    </div>
    <div class="profile-item" style="grid-column: 1 / -1">
      <i class="bi bi-heart"></i>
      <span class="profile-label">Health Status:</span>
      <span class="profile-value">{{ Patient.history }}
        <button class="edit-btn" aria-label="Edit Health Status" (click)="EditDetails()">
          <i class="bi bi-pencil"></i>
        </button>
      </span>
    </div>
    <div class="profile-item" style="grid-column: 1 / -1">
      <i class="bi bi-file-earmark-medical"></i>
      <span class="profile-label">Health Report:</span>
      <div class="d-flex align-items-center mt-2">
        <button *ngIf="Patient?.reportFilePath" (click)="downloadReport()" class="btn btn-sm btn-outline-primary me-2"
          [disabled]="!Patient?.reportFilePath">
          <i class="bi bi-download"></i> Download Report
        </button>
        <span class="text-muted small" *ngIf="Patient?.reportFilePath">
          {{ getReportFileName() }}
        </span>
        <span class="text-muted small" *ngIf="!Patient?.reportFilePath">
          No report available
        </span>
      </div>
    </div>
  </section>

  <section *ngIf="Patient" role="region" aria-label="Health Overview" class="overview-card" tabindex="0">
    <h4 class="overview-header">Health Overview</h4>
    <div class="metric">
      <!-- Trigger Button -->
      <span class="metric-label" (click)="openAppointmentsModal()">
        <i class="bi bi-calendar-check"></i> Upcoming Appointments</span>

      <!-- <ng-container *ngIf="Patient?.appointments?.length">
  <div *ngFor="let upcomingAppointment of Patient.appointments, index as i" class="metric-value"> 
    <h6 style="color: black;">Appointment {{ i + 1 }}</h6> 
    <span style="color: darkgoldenrod;">Date & Time:</span>
    {{ upcomingAppointment.availabilityDatetime | date: 'mediumDate' }}
    {{ upcomingAppointment.availabilityDatetime | date: 'shortTime' }}<br>
    <span style="color: darkgoldenrod;">Doctor:</span> {{ upcomingAppointment.doctorName }}<br>
    <span style="color: darkgoldenrod;">Address:</span> {{ upcomingAppointment.clinicAddress }}
  </div>
</ng-container> -->
    </div>
    <div class="metric">
      <span class="metric-label"><i class="bi bi-capsule"></i> Active Medications</span>
      <span class="metric-value">{{ Patient.medications?.length || 0 }}</span>
    </div>
    <div class="metric">
      <span class="metric-label"><i class="bi bi-capsule"></i> Health Score</span>
      <span class="metric-value">{{ Patient.healthScore || "N/A" }}</span>
    </div>
  </section>

  <section *ngIf="!Patient" class="new-user" role="region" aria-label="New User Welcome">
    <h1>Welcome New User!</h1>
    <p>Add Your Details From Here</p>
    <button class="btn-add-details" (click)="addDetails()">Add Details</button>
  </section>
</div>

<p style="text-align: center; color: gray; margin-top: 10px">
  Your Health details are shared with the doctor you choose to book an
  appointment with. <br />Please ensure that the information is accurate and
  up-to-date to facilitate better healthcare services. <br />For any assistance,
  please contact our support team.
</p>

<!-- Appointments Modal -->
<div class="modal fade" id="appointmentsModal" tabindex="-1" aria-labelledby="appointmentsModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="appointmentsModalLabel">
          Your Upcoming Appointments
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body" *ngIf="Patient?.appointments?.length">
        <div *ngFor="let appointment of Patient.appointments; let i = index"
          class="mb-4 p-3 border rounded shadow-sm bg-light">
          <h6>Appointment {{ i + 1 }}</h6>
          <p>
            <strong>Date:</strong>
            {{ appointment.availabilityDatetime | date : "mediumDate" }}
            <strong style="margin-left: 20%;">Time:</strong>
            {{ appointment.availabilityDatetime | date : "shortTime" }}
          </p>
          <p><strong>Doctor:</strong> {{ appointment.doctorName }}</p>
          <p><strong>Clinic Address:</strong> {{ appointment.clinicAddress }}</p>
          <p><strong>Location:</strong> {{ appointment.doctorCity }}</p>
          <button class="btn btn-danger btn-sm" (click)="cancelAppointment(appointment.appointmentId)">
            Cancel
          </button>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Close
        </button>
      </div>
    </div>
  </div>
</div>